/*! For license information please see qlik-modifiers.5379ddaa35428ea759a8.js.LICENSE.txt */
/*!
 * sense-client@7.144.6
 * 
 * Copyright(C) 2021 Qlik International AB
 * All Rights Reserved
 * 
 */
(window["qJsonp"]=window["qJsonp"]||[]).push([[14],{TmNk:function(e,r,n){!function(r,n){e.exports=n()}(window,(function(){return function(e){var r={};function n(i){if(r[i])return r[i].exports;var t=r[i]={i:i,l:!1,exports:{}};return e[i].call(t.exports,t,t.exports,n),t.l=!0,t.exports}return n.m=e,n.c=r,n.d=function(e,r,i){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var t in e)n.d(i,t,function(r){return e[r]}.bind(null,t));return i},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="/qlik-modifiers/",n(n.s=1)}([function(e,r,n){"use strict";var i=Object.prototype.hasOwnProperty,t=Object.prototype.toString,o=Object.defineProperty,s=Object.getOwnPropertyDescriptor,a=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===t.call(e)},u=function(e){if(!e||"[object Object]"!==t.call(e))return!1;var r,n=i.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&i.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!o)return!1;for(r in e);return void 0===r||i.call(e,r)},l=function(e,r){o&&"__proto__"===r.name?o(e,r.name,{enumerable:!0,configurable:!0,value:r.newValue,writable:!0}):e[r.name]=r.newValue},c=function(e,r){if("__proto__"===r){if(!i.call(e,r))return;if(s)return s(e,r).value}return e[r]};e.exports=function e(){var r,n,i,t,o,s,p=arguments[0],f=1,m=arguments.length,d=!1;for("boolean"==typeof p&&(d=p,p=arguments[1]||{},f=2),(null==p||"object"!=typeof p&&"function"!=typeof p)&&(p={});f<m;++f)if(null!=(r=arguments[f]))for(n in r)i=c(p,n),p!==(t=c(r,n))&&(d&&t&&(u(t)||(o=a(t)))?(o?(o=!1,s=i&&a(i)?i:[]):s=i&&u(i)?i:{},l(p,{name:n,newValue:e(d,s,t)})):void 0!==t&&l(p,{name:n,newValue:t}));return p}},function(e,r,n){"use strict";n.r(r);var i=n(0),t=n.n(i),o={setValue:function(e,r,n){if(!r)return!1;var i,t=r.split("."),o=t[t.length-1],s=e;for(i=0;i<t.length-1;++i)void 0===s[t[i]]&&(s[t[i]]=Number.isNaN(+t[i+1])?{}:[]),s=s[t[i]];if(void 0!==n){var a=s[o];return s[o]=n,{updated:n,previous:a}}return delete s[o],!1},getValue:function(e,r,n){var i,t=r.split("."),o=e;if(void 0===o)return n;for(i=0;i<t.length;++i){if(void 0===o[t[i]])return n;o=o[t[i]]}return o}},s="".concat(" ","(").concat("　"),a="".concat("　",")").concat(" ");function u(e){return s+e+a}function l(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.qLibraryId){var n=function(e,r){if(!r)return null;var n,i;for(n=0;n<r.length;n++)if((i=r[n]).qInfo.qId===e)return i;return null}(e.qLibraryId,r.dimensionList);return n&&n.qData.info[0].qTags.indexOf("$numeric")>-1}var i=function(e,r){if(!r)return null;var n,i,t=function(e){var r=e.trim();"="===r.charAt(0)&&(r=(r=r.substring(1)).trim());var n=r.length-1;return"["===r.charAt(0)&&"]"===r.charAt(n)&&(r=(r=r.substring(1,n)).trim()),r}(e);for(n=0;n<r.length;n++){if((i=r[n]).qName===t)return i;if(i.qDerivedFieldData)for(var o=0;o<i.qDerivedFieldData.qDerivedFieldLists.length;++o)for(var s=i.qDerivedFieldData.qDerivedFieldLists[o],a=0;a<s.qFieldDefs.length;++a){var u=s.qFieldDefs[a];if(u.qName===t)return u}}return null}(e.qDef.qFieldDefs[0],r.fieldList);return i&&i.qTags.indexOf("$numeric")>-1}function c(e){return!(!e.fullAccumulation&&!e.fullRange)}function p(e,r){var n=e.crossAllDimensions;return 2===r&&n?"RowNo(Total)":"RowNo()"}function f(e){var r=function(e){return e?(e=function(e){return e.replace(/\/\*[^]*?\*\//g,"")}(e=function(e){return e.replace(/\/\/(.*)$/gm,"")}(e))).trim():""}(e).trim();return"="===r.substring(0,1)?r.substring(1).trim():r}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return"[$(=Replace(GetObjectField(".concat(e,"),']',']]'))]")}function d(e,r){var n=e.crossAllDimensions;return 2===r&&n?"Above(Total ":"Above("}function y(e){return void 0===e?")":", 0, ".concat(e,")")}function g(e,r){return e?"".concat(r,'={">=$(=Min(').concat(r,"))<=$(=Max(").concat(r,'))"}'):"".concat(r,'={"=Only({1}').concat(r,")>='$(=MinString(").concat(r,"))' and Only({1}").concat(r,")<='$(=MaxString(").concat(r,"))'\"}")}function b(e){var r=e.modifier,n=void 0===r?{}:r,i=e.dimensions,t=e.dimensionAndFieldList,o=e.funcComp,s=void 0===o?"Sum":o,a=e.valueComp,u=void 0===a?"0":a;if(!n.showExcludedValues)return"";if(i&&1===i.length){var c=g(l(i[0],t),m(0));return"".concat(s,"({1<").concat(c,">}").concat(u,")")}if(i&&2===i.length){var p=l(i[0],t),f=l(i[1],t),d=m(0),y=m(1),b=g(p,d),v=g(f,y);return"".concat(s,"({1<").concat(b,",").concat(v,">}").concat(u,")")}return"".concat(s,"({1}").concat(u,")")}function v(e){return"".concat(e,"(")}function D(){return")"}function q(e){var r=e.properties,n=e.layout;return o.getValue(r,"qHyperCubeDef.qDimensions",o.getValue(n,"qHyperCube.qDimensionInfo",[])).length}var h={isFullRange:c,getNumDimensions:q,getExpressionWithExcludedComp:function(e){var r=e.expression,n=e.modifier,i=e.dimensions,t=e.dimensionAndFieldList,o=e.treatMissingAsNull,s=u(f(r));if(!n.showExcludedValues)return s;var a=b({modifier:n,dimensions:i,dimensionAndFieldList:t}),l=o?"":", 0";if(i&&1===i.length){var c=m(0);return"If(Count(".concat(c,") > 0, ").concat(s," + ").concat(a).concat(l,")")}if(i&&2===i.length){var p=m(0),d=m(1);return"If(Count(".concat(p,") * Count(").concat(d,") > 0, ").concat(s," + ").concat(a).concat(l,")")}return s},getRowNoComp:p,getNumStepComp:function(e,r){if(!c(e)){var n=e.steps;return"number"!=typeof n||Number.isNaN(n)?6:n}return p(e,r)},getAboveCompPrefix:d,getAboveCompSuffix:y,getAboveComp:function(e,r,n,i){return d(e,r)+n+y(i)},getFunctionPrefix:v,getFunctionSuffix:D,getRangeComp:function(e,r){return v(e)+r+")"},getAggrComp:function(e,r,n){return"Aggr(".concat(e,", ").concat(r,", ").concat(n,")")},getExcludedComp:b,needDimension:function(e){var r=e.modifier,n=e.properties,i=e.layout;return 0===function(e){return void 0===e.primaryDimension?e.accumulationDimension:e.primaryDimension}(r)&&2===q({properties:n,layout:i})},getDimComp:function(e,r){var n=function(e){return e[arguments.length>1&&void 0!==arguments[1]?arguments[1]:0].qDef.qSortCriterias[0]}(e,r),i=m(r);if(!n.qSortByExpression&&!n.qSortByNumeric&&!n.qSortByAscii)return i;var t=["Descending","Ascending"],o=n.qSortByNumeric?"(Numeric, ".concat(t[(n.qSortByNumeric+1)/2],")"):"",s=n.qSortByAscii?"(Text, ".concat(t[(n.qSortByAscii+1)/2],")"):"";return n.qSortByNumeric&&n.qSortByAscii?"(".concat(i,", ").concat(o,", ").concat(s,")"):n.qSortByNumeric?"(".concat(i,", ").concat(o,")"):n.qSortByAscii?"(".concat(i,", ").concat(s,")"):i},simplifyExpression:f,extractInputExpression:function(e){var r=e.outputExpression;if(e.modifier){var n=r.indexOf(s);if(-1!==n){var i=r.indexOf(a);if(-1!==i)return r.substring(n+s.length,i)}}},initModifier:function(e,r){Object.keys(r).forEach((function(n){void 0===e[n]&&(e[n]=r[n])}))},isNumeric:l,isApplicable:function(e){var r=e.properties,n=e.layout,i=e.minDimensions,t=void 0===i?1:i,o=e.maxDimensions,s=void 0===o?2:o;if(!r&&!n)return!0;var a=q({properties:r,layout:n});return a>=t&&a<=s},getExpressionWithMarkers:u,canExtract:function(e){var r=e.indexOf(s),n=e.indexOf(a);return r>-1&&n>-1&&r<n},getDimDefWithWrapper:m,getFieldWithWrapper:function(e){var r=e?e.replace(/]/g,"]]"):e;return"[".concat(r,"]")}};function E(e){return function(e){if(Array.isArray(e)){for(var r=0,n=new Array(e.length);r<e.length;r++)n[r]=e[r];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var I=t.a.bind(null,!0),S={},x=Array.isArray;function L(e){return null!=e&&!Array.isArray(e)&&"object"===A(e)}function V(e){return void 0===e}function N(e,r){return"function"==typeof e[r]||"$$"===r.substring(0,2)||"_"===r.substring(0,1)}function C(e,r){var n,i=r.substring(1).split("/").slice(0,-1);return i.forEach((function(r,t){if(t!==i.length){n=+r;var o=Number.isNaN(n)?{}:[];e[n||r]=V(e[n||r])?o:e[r],e=e[n||r]}})),e}function F(e,r){var n=!0;if(L(e)&&L(r))return Object.keys(e).length===Object.keys(r).length&&(Object.keys(e).forEach((function(i){F(e[i],r[i])||(n=!1)})),n);if(x(e)&&x(r)){if(e.length!==r.length)return!1;for(var i=0,t=e.length;i<t;i+=1)if(!F(e[i],r[i]))return!1;return!0}return e===r}S.generate=function(e,r,n){n=n||"";var i=[];return Object.keys(r).forEach((function(t){var o=function(e){return e?I({},{val:e}).val:e}(r[t]),s=e[t],a="".concat(n,"/").concat(t);F(o,s)||N(r,t)||(V(s)?i.push({op:"add",path:a,value:o}):L(o)&&L(s)?i=i.concat(S.generate(s,o,a)):x(o)&&x(s)?i=i.concat(function(e,r,n){var i=[],t=e.slice(),o=-1;function s(e,r,n){if(e[n]&&V(e[n].qInfo))return null;if(e[n]&&e[n].qInfo.qId===r)return n;for(var i=0,t=e.length;i<t;i+=1)if(e[i]&&e[i].qInfo.qId===r)return i;return-1}if(F(r,t))return i;if(!V(r[0])&&V(r[0].qInfo))return i.push({op:"replace",path:n,value:r}),i;for(var a=t.length-1;a>=0;a-=1)-1===(o=s(r,t[a].qInfo&&t[a].qInfo.qId,a))?(i.push({op:"remove",path:"".concat(n,"/").concat(a)}),t.splice(a,1)):i=i.concat(S.generate(t[a],r[o],"".concat(n,"/").concat(a)));for(var u=0,l=r.length;u<l;u+=1)-1===(o=s(t,r[u].qInfo&&r[u].qInfo.qId))?(i.push({op:"add",path:"".concat(n,"/").concat(u),value:r[u]}),t.splice(u,0,r[u])):o!==u&&(i.push({op:"move",path:"".concat(n,"/").concat(u),from:"".concat(n,"/").concat(o)}),t.splice(u,0,t.splice(o,1)[0]));return i}(s,o,a)):i.push({op:"replace",path:"".concat(n,"/").concat(t),value:o}))})),Object.keys(e).forEach((function(t){V(r[t])&&!N(e,t)&&i.push({op:"remove",path:"".concat(n,"/").concat(t)})})),i},S.apply=function(e,r){r.forEach((function(r){var n,i=C(e,r.path),t=r.path.split("/").splice(-1)[0],o=t&&Number.isNaN(+t)?i[t]:i[+t]||i,s=r.from?r.from.split("/").splice(-1)[0]:null;if("/"===r.path&&(i=null,o=e),"add"===r.op||"replace"===r.op)if(x(i))"-"===t&&(t=i.length),i.splice(+t,"add"===r.op?0:1,r.value);else if(x(o)&&x(r.value)){var a,u=r.value.slice();o.length=0,(a=o).push.apply(a,E(u))}else if(L(o)&&L(r.value))n=o,Object.keys(n).forEach((function(e){Object.getOwnPropertyDescriptor(n,e).configurable&&!N(n,e)&&delete n[e]})),I(o,r.value);else{if(!i)throw new Error("Patchee is not an object we can patch");i[t]=r.value}else if("move"===r.op){var l=C(e,r.from);x(i)?i.splice(+t,0,l.splice(+s,1)[0]):(i[t]=l[s],delete l[s])}else"remove"===r.op&&(x(i)?i.splice(+t,1):delete i[t])}))},S.clone=function(e){return I({},e)},S.createPatch=function(e,r,n){var i={op:e.toLowerCase(),path:n};return"move"===i.op?i.from=r:void 0!==r&&(i.value=r),i},S.updateObject=function(e,r){Object.keys(e).length?S.apply(e,S.generate(e,r)):I(e,r)};var w=S,O={saveSoftProperties:function(e,r,n){if(!e)return Promise.resolve();var i=w.generate(r,n);return t()(!0,r,n),i&&i.length?(i=i.map((function(e){return{qOp:e.op,qValue:JSON.stringify(e.value),qPath:e.path}})),e.applyPatches(i,!0)):Promise.resolve()}},M="accumulation";function T(e,r){var n=o.getValue(e,r);if(n)for(var i=0;i<n.length;i++)if(n[i].type===M)return n[i]}function P(e,r){var n=function(e,r){var n=o.getValue(e,r);if(!n)return-1;for(var i=0;i<n.length;i++)if(n[i].type===M)return i;return-1}(e,r);return n>-1?"".concat(r,".").concat(n):r}var R={type:"accumulation",disabled:!1,accumulationDimension:0,crossAllDimensions:!1,showExcludedValues:!0,fullAccumulation:!1,steps:6,outputExpression:""},j={translationKey:"properties.modifier.accumulation",needDimension:h.needDimension,isApplicable:function(e){var r=e.properties,n=e.layout;return h.isApplicable({properties:r,layout:n,minDimensions:1,maxDimensions:2})},generateExpression:function(e){var r=e.expression,n=e.modifier,i=e.properties,t=e.layout,s=e.numDimensions,a=e.dimensionAndFieldList;if(!n)return r;var u=s;void 0===u&&(u=h.getNumDimensions({properties:i,layout:t}));var l=o.getValue(i,"qHyperCubeDef.qDimensions",[]),c=h.getExpressionWithExcludedComp({expression:r,modifier:n,dimensions:l,dimensionAndFieldList:a}),p=h.getNumStepComp(n,u),f=h.getAboveComp(n,u,c,p),m=h.getRangeComp("RangeSum",f);if(h.needDimension({modifier:n,properties:i,layout:t})){var d=h.getDimComp(l,1),y=h.getDimComp(l,0),g=h.getAggrComp(m,d,y);m=n.showExcludedValues?h.getExcludedComp({modifier:n,dimensions:l,dimensionAndFieldList:a,valueComp:g}):g}return m},extractInputExpression:h.extractInputExpression,initModifier:function(e){h.initModifier(e,R)},enableTotalsFunction:function(){return!1},propertyPanelDef:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={type:"items",items:{disclaimer:{component:"text",translation:r.disclaimer||"properties.modifier.accumulation.disclaimer",show:function(e,r){return!h.isApplicable({properties:r.properties})}},settings:{type:"items",items:{primaryDimension:{refFn:function(r){return"".concat(P(r,e),".accumulationDimension")},type:"integer",translation:r.primaryDimension||"properties.modifier.primaryDimension",title:{translation:r.primaryDimensionTooltip||"properties.modifier.accumulation.primaryDimension.tooltip"},component:"dropdown",schemaIgnore:!0,defaultValue:1,options:function(e,r){return r.layout.qHyperCube.qDimensionInfo.map((function(e,r){return{value:r,label:e.qGroupFallbackTitles[0]}}))},show:function(e,r){return r.layout.qHyperCube.qDimensionInfo.length>1}},crossAllDimensions:{refFn:function(r){return"".concat(P(r,e),".crossAllDimensions")},type:"boolean",translation:r.crossAllDimensions||"properties.modifier.crossAllDimensions",title:{translation:r.crossAllDimensionsTooltip||"properties.modifier.accumulation.crossAllDimensions.tooltip"},schemaIgnore:!0,defaultValue:!1,show:function(e,r){return r.layout.qHyperCube.qDimensionInfo.length>1}},fullRange:{refFn:function(r){return"".concat(P(r,e),".fullAccumulation")},type:"boolean",translation:r.range||"properties.modifier.range",component:"dropdown",schemaIgnore:!0,defaultValue:!1,options:[{value:!0,translation:r.rangeFull||"properties.modifier.range.full"},{value:!1,translation:r.rangeCustom||"properties.modifier.range.custom"}]},steps:{refFn:function(r){return"".concat(P(r,e),".steps")},type:"integer",translation:r.rangeSteps||"properties.modifier.range.steps",schemaIgnore:!0,defaultValue:6,change:function(r){var n=T(r,e);if(n){var i=n.steps;n.steps="number"!=typeof i||Number.isNaN(i)?6:Math.abs(i)}},show:function(r){var n=T(r,e);return n&&!n.fullAccumulation}},showExcludedValues:{refFn:function(r){return"".concat(P(r,e),".showExcludedValues")},type:"boolean",translation:r.showExcludedValues||"properties.modifier.showExcludedValues",schemaIgnore:!0,defaultValue:!0}},show:function(e,r){return h.isApplicable({properties:r.properties})}}},show:function(r,n,i){var t=i.ext.support.modifiers;if(!(Array.isArray(t)&&-1!==t.indexOf(M)))return!1;var o=T(r,e);return o&&!o.disabled}};return n}},_="movingAverage";function H(e,r){var n=o.getValue(e,r);if(n)for(var i=0;i<n.length;i++)if(n[i].type===_)return n[i]}function k(e,r){var n=function(e,r){var n=o.getValue(e,r);if(!n)return-1;for(var i=0;i<n.length;i++)if(n[i].type===_)return i;return-1}(e,r);return n>-1?"".concat(r,".").concat(n):r}var B={type:"movingAverage",disabled:!1,primaryDimension:0,crossAllDimensions:!1,showExcludedValues:!0,fullRange:!1,steps:6,outputExpression:"",nullSuppression:!1};var W={translationKey:"properties.modifier.movingAverage",needDimension:h.needDimension,isApplicable:function(e){var r=e.properties,n=e.layout;return h.isApplicable({properties:r,layout:n,minDimensions:1,maxDimensions:2})},generateExpression:function(e){var r,n=e.expression,i=e.modifier,t=e.properties,s=e.layout,a=e.numDimensions,u=e.dimensionAndFieldList;if(!i)return n;var l=a;void 0===l&&(l=h.getNumDimensions({properties:t,layout:s}));var c=o.getValue(t,"qHyperCubeDef.qDimensions",[]),p=i.showExcludedValues&&i.nullSuppression,f=h.getExpressionWithExcludedComp({expression:n,modifier:i,dimensions:c,dimensionAndFieldList:u,treatMissingAsNull:p}),m=h.getNumStepComp(i,l),d=h.getAboveComp(i,l,f,m);if(i.nullSuppression)r=h.getRangeComp("RangeAvg",d);else{var y=h.getRangeComp("RangeSum",d),g=function(e,r){var n=h.getRowNoComp(e,r);if(!h.isFullRange(e)){var i=e.steps,t="number"!=typeof i||Number.isNaN(i)?6:i;return"RangeMin(".concat(t,", ").concat(n,")")}return n}(i,l);r="".concat(y," / ").concat(g)}var b=r;if(h.needDimension({modifier:i,properties:t,layout:s})){var v=h.getDimComp(c,1),D=h.getDimComp(c,0),q=h.getAggrComp(b,v,D);b=i.showExcludedValues?h.getExcludedComp({modifier:i,dimensions:c,dimensionAndFieldList:u,funcComp:"Only",valueComp:q}):q}return b},extractInputExpression:h.extractInputExpression,initModifier:function(e){h.initModifier(e,B)},enableTotalsFunction:function(){return!1},propertyPanelDef:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={type:"items",items:{disclaimer:{component:"text",translation:r.disclaimer||"properties.modifier.movingAverage.disclaimer",show:function(e,r){return!h.isApplicable({properties:r.properties})}},settings:{type:"items",items:{primaryDimension:{refFn:function(r){return"".concat(k(r,e),".primaryDimension")},type:"integer",translation:r.primaryDimension||"properties.modifier.primaryDimension",title:{translation:r.primaryDimensionTooltip||"properties.modifier.movingAverage.primaryDimension.tooltip"},component:"dropdown",schemaIgnore:!0,defaultValue:1,options:function(e,r){return r.layout.qHyperCube.qDimensionInfo.map((function(e,r){return{value:r,label:e.qGroupFallbackTitles[0]}}))},show:function(e,r){return r.layout.qHyperCube.qDimensionInfo.length>1}},crossAllDimensions:{refFn:function(r){return"".concat(k(r,e),".crossAllDimensions")},type:"boolean",translation:r.crossAllDimensions||"properties.modifier.crossAllDimensions",title:{translation:r.crossAllDimensionsTooltip||"properties.modifier.movingAverage.crossAllDimensions.tooltip"},schemaIgnore:!0,defaultValue:!1,show:function(e,r){return r.layout.qHyperCube.qDimensionInfo.length>1}},fullRange:{refFn:function(r){return"".concat(k(r,e),".fullRange")},type:"boolean",translation:r.range||"properties.modifier.range",component:"dropdown",schemaIgnore:!0,defaultValue:!1,options:[{value:!0,translation:r.rangeFull||"properties.modifier.range.full"},{value:!1,translation:r.rangeCustom||"properties.modifier.range.custom"}]},steps:{refFn:function(r){return"".concat(k(r,e),".steps")},type:"integer",translation:r.rangeSteps||"properties.modifier.range.steps",schemaIgnore:!0,defaultValue:6,change:function(r){var n=H(r,e);if(n){var i=n.steps;n.steps="number"!=typeof i||Number.isNaN(i)?6:Math.abs(i)}},show:function(r){var n=H(r,e);return n&&!n.fullRange}},showExcludedValues:{refFn:function(r){return"".concat(k(r,e),".showExcludedValues")},type:"boolean",translation:r.showExcludedValues||"properties.modifier.showExcludedValues",schemaIgnore:!0,defaultValue:!0},nullSuppression:{refFn:function(r){return"".concat(k(r,e),".nullSuppression")},type:"boolean",translation:r.showNull||"properties.dimensions.showNull",schemaIgnore:!0,defaultValue:!1,inverted:!0}},show:function(e,r){return h.isApplicable({properties:r.properties})}}},show:function(r,n,i){var t=i.ext.support.modifiers;if(!(Array.isArray(t)&&-1!==t.indexOf(_)))return!1;var o=H(r,e);return o&&!o.disabled}};return n}},G="difference";function $(e,r){var n=o.getValue(e,r);if(n)for(var i=0;i<n.length;i++)if(n[i].type===G)return n[i]}function U(e,r){var n=function(e,r){var n=o.getValue(e,r);if(!n)return-1;for(var i=0;i<n.length;i++)if(n[i].type===G)return i;return-1}(e,r);return n>-1?"".concat(r,".").concat(n):r}var J={type:"difference",disabled:!1,primaryDimension:0,crossAllDimensions:!1,showExcludedValues:!0,outputExpression:""},z={translationKey:"properties.modifier.difference",needDimension:h.needDimension,isApplicable:function(e){var r=e.properties,n=e.layout;return h.isApplicable({properties:r,layout:n,minDimensions:1,maxDimensions:2})},extractInputExpression:h.extractInputExpression,generateExpression:function(e){var r=e.expression,n=e.modifier,i=e.properties,t=e.layout,s=e.numDimensions,a=e.dimensionAndFieldList;if(!n)return r;var u=s;void 0===u&&(u=h.getNumDimensions({properties:i,layout:t}));var l=o.getValue(i,"qHyperCubeDef.qDimensions",[]),c=h.getExpressionWithExcludedComp({expression:r,modifier:n,dimensions:l,dimensionAndFieldList:a}),p=h.getAboveComp(n,u,c),f="".concat(c," - ").concat(p);if(h.needDimension({modifier:n,properties:i,layout:t})){var m=h.getDimComp(l,1),d=h.getDimComp(l,0),y=h.getAggrComp(f,m,d);f=n.showExcludedValues?h.getExcludedComp({modifier:n,dimensions:l,dimensionAndFieldList:a,funcComp:"Only",valueComp:y}):y}return f},initModifier:function(e){Object.keys(J).forEach((function(r){void 0===e[r]&&(e[r]=J[r])}))},enableTotalsFunction:function(){return!1},propertyPanelDef:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={type:"items",items:{disclaimer:{component:"text",translation:r.disclaimer||"properties.modifier.difference.disclaimer",show:function(e,r){return!h.isApplicable({properties:r.properties})}},settings:{type:"items",items:{primaryDimension:{refFn:function(r){return"".concat(U(r,e),".primaryDimension")},type:"integer",translation:r.primaryDimension||"properties.modifier.primaryDimension",title:{translation:r.primaryDimensionTooltip||"properties.modifier.difference.primaryDimension.tooltip"},component:"dropdown",schemaIgnore:!0,defaultValue:1,options:function(e,r){return r.layout.qHyperCube.qDimensionInfo.map((function(e,r){return{value:r,label:e.qGroupFallbackTitles[0]}}))},show:function(e,r){return r.layout.qHyperCube.qDimensionInfo.length>1}},crossAllDimensions:{refFn:function(r){return"".concat(U(r,e),".crossAllDimensions")},type:"boolean",translation:r.crossAllDimensions||"properties.modifier.crossAllDimensions",title:{translation:r.crossAllDimensionsTooltip||"properties.modifier.difference.crossAllDimensions.tooltip"},schemaIgnore:!0,defaultValue:!1,show:function(e,r){return r.layout.qHyperCube.qDimensionInfo.length>1}},showExcludedValues:{refFn:function(r){return"".concat(U(r,e),".showExcludedValues")},type:"boolean",translation:r.showExcludedValues||"properties.modifier.showExcludedValues",schemaIgnore:!0,defaultValue:!0}},show:function(e,r){return h.isApplicable({properties:r.properties})}}},show:function(r,n,i){var t=i.ext.support.modifiers;if(!(Array.isArray(t)&&-1!==t.indexOf(G)))return!1;var o=$(r,e);return o&&!o.disabled}};return n}},K={SELECTION:{CURRENT_SELECTION:0,SELECT_FIELD_VALUE:1,DISREGARD_SELECTION:2},DIMENSION:{ONE_DIMENSION:0,ALL_DIMENSIOANS:1,DISREGARD_ALL_DIMENSIONS:2}},Q="normalization";function X(e,r){var n=o.getValue(e,r);if(n)for(var i=0;i<n.length;i++)if(n[i].type===Q)return n[i]}function Y(e,r){var n=function(e,r){var n=o.getValue(e,r);if(!n)return-1;for(var i=0;i<n.length;i++)if(n[i].type===Q)return i;return-1}(e,r);return n>-1?"".concat(r,".").concat(n):r}function Z(e,r){for(var n=0;n<e.length;n++)if(e[n].value===r)return n;return-1}function ee(e,r,n,i){var t=r.layout.qHyperCube.qDimensionInfo.length,o=[{value:K.DIMENSION.ONE_DIMENSION,translation:n.dimensionalScopeOneDimension||"properties.modifier.dimensionalScope.respectOneDimension",tooltipTranslation:n.dimensionalScopeOneDimensionTooltip||"properties.modifier.dimensionalScope.respectOneDimension.tooltip"},{value:K.DIMENSION.ALL_DIMENSIOANS,translation:n.dimensionalScopeAllDimensions||"properties.modifier.dimensionalScope.".concat(2===t?"respectAllDimensions":"respectDimension"),tooltipTranslation:n.dimensionalScopeAllDimensionsTooltip||"properties.modifier.dimensionalScope.".concat(2===t?"respectAllDimensions":"respectDimension",".tooltip")},{value:K.DIMENSION.DISREGARD_ALL_DIMENSIONS,translation:n.dimensionalScopeDisregardAllDimensions||"properties.modifier.dimensionalScope.".concat(2===t?"disregardAllDimensions":"disregardDimension"),tooltipTranslation:n.dimensionalScopeDisregardAllDimensionsTooltip||"properties.modifier.dimensionalScope.".concat(2===t?"disregardAllDimensions":"disregardDimension",".tooltip")}];return o=function(e,r,n){if(e<2){var i=Z(r,n);r.splice(i,1)}return r}(t,o,0),function(e,r,n){if(0===e){var i=Z(r,n);r.splice(i,1)}return r}(X(e,i).selectionScope,o,1)}function re(e,r,n){var i=[{value:K.SELECTION.CURRENT_SELECTION,translation:r.selectionScopeCurrentSelection||"properties.modifier.selectionScope.currentSelection"},{value:K.SELECTION.SELECT_FIELD_VALUE,translation:r.selectionScopeSpecificValue||"properties.modifier.selectionScope.selectAField"},{value:K.SELECTION.DISREGARD_SELECTION,translation:r.selectionScopeTotal||"properties.modifier.selectionScope.total"}];return function(e,r,n){if(1===e){var i=Z(r,n);r.splice(i,1)}return r}(X(e,n).dimensionalScope,i,0)}var ne={type:"normalization",disabled:!1,primaryDimension:0,outputExpression:"",dimensionalScope:K.DIMENSION.DISREGARD_ALL_DIMENSIONS,selectionScope:K.SELECTION.DISREGARD_SELECTION};function ie(e){return 2===e?"{1}":""}function te(e,r,n){return 1===e?"{$<".concat(h.getFieldWithWrapper(r),"={'").concat(n,"'}>}"):""}function oe(e,r){return 0===e&&r>1||2===e?"Total":""}function se(e,r,n){return 0===e&&r>1?"<".concat(h.getDimDefWithWrapper(n),">"):""}function ae(e,r,n,i,t,o,s){var a=ie(r),u=te(r,n,i),l=""===a&&""===u?"":a||u,c=oe(t,o),p=se(t,o,s),f=function(e){for(var r=[],n=0;n<e;n++)r[n]=h.getDimDefWithWrapper(n);return r.join(", ")}(o);return"".concat(e,"/ Sum(").concat(l," ").concat(c).concat(p," Aggr(").concat(l," ").concat(e,", ").concat(f,"))")}var ue={translationKey:"properties.modifier.normalization",needDimension:function(){return!0},isApplicable:function(e){var r=e.properties,n=e.layout;return h.isApplicable({properties:r,layout:n,minDimensions:1,maxDimensions:2})},extractInputExpression:h.extractInputExpression,generateExpression:function(e){var r=e.expression,n=e.modifier,i=e.properties,t=e.layout,s=e.numDimensions,a=e.dimensionAndFieldList;if(!n)return r;var u=s;void 0===u&&(u=h.getNumDimensions({properties:i,layout:t}));var l=o.getValue(i,"qHyperCubeDef.qDimensions",[]),c=h.getExpressionWithExcludedComp({expression:r,modifier:n,dimensions:l,dimensionAndFieldList:a}),p=n.selectionScope,f=n.dimensionalScope;return ae(c,p,n.field,n.value,f,u,n.primaryDimension)},initModifier:function(e){Object.keys(ne).forEach((function(r){void 0===e[r]&&(e[r]=ne[r])}))},updateModifier:function(e,r){1===(r.qDimensions?r.qDimensions.length:0)&&0===e.dimensionalScope&&(e.dimensionalScope=2)},enableTotalsFunction:function(){return!0},propertyPanelDef:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={type:"items",items:{disclaimer:{component:"text",translation:r.disclaimer||"properties.modifier.normalization.disclaimer",show:function(e,r){return!h.isApplicable({properties:r.properties})}},settings:{type:"items",items:{selectionScope:{refFn:function(r){return"".concat(Y(r,e),".selectionScope")},type:"string",translation:r.modifierSelectionScope||"properties.modifier.selectionScope",title:{translation:r.modifierSelectionScopeTooltip||"properties.modifier.selectionScope.tooltip"},component:"dropdown",schemaIgnore:!0,defaultValue:K.SELECTION.DISREGARD_SELECTION,options:function(n){return re(n,r,e)}},field:{refFn:function(r){return"".concat(Y(r,e),".field")},type:"string",component:"expression-with-dropdown",translation:"Common.Field",defaultValue:"",dropdownOnly:!0,options:function(e,r,n){return n.app.getFieldList().then((function(e){return e.map((function(e){return{label:e.qName,value:e.qName}}))}))},show:function(r){return X(r,e).selectionScope===K.SELECTION.SELECT_FIELD_VALUE}},value:{refFn:function(r){return"".concat(Y(r,e),".value")},type:"string",ref:"value",component:"string",translation:"properties.value",expression:"optional",show:function(r){return X(r,e).selectionScope===K.SELECTION.SELECT_FIELD_VALUE}},dimensionalScope:{refFn:function(r){return"".concat(Y(r,e),".dimensionalScope")},type:"string",translation:r.modifierDimensionalScope||"properties.modifier.dimensionalScope",title:{translation:r.modifierDimensionalScopeTooltip||"properties.modifier.dimensionalScope.tooltip"},component:"dropdown",schemaIgnore:!0,defaultValue:K.DIMENSION.DISREGARD_ALL_DIMENSIONS,supportTooltip:!0,options:function(n,i){return ee(n,i,r,e)}},primaryDimension:{refFn:function(r){return"".concat(Y(r,e),".primaryDimension")},type:"integer",translation:r.primaryDimension||"properties.modifier.primaryDimension",title:{translation:r.primaryDimensionTooltip||"properties.modifier.normalization.primaryDimension.tooltip"},component:"dropdown",schemaIgnore:!0,defaultValue:1,options:function(e,r){return r.layout.qHyperCube.qDimensionInfo.map((function(e,r){return{value:r,label:e.qGroupFallbackTitles[0]}}))},show:function(r,n){return(X(r,e).dimensionalScope||0)===K.DIMENSION.ONE_DIMENSION&&n.layout.qHyperCube.qDimensionInfo.length>1}}},show:function(e,r){return h.isApplicable({properties:r.properties})}}},show:function(r,n,i){var t=i.ext.support.modifiers;if(!(Array.isArray(t)&&-1!==t.indexOf(Q)))return!1;var o=X(r,e);return o&&!o.disabled}};return n},getDisregardSelectionComp:ie,getFieldSelectionComp:te,getTotalComp:oe,getSelectedDimComp:se};function le(e){var r=e.model,n=e.callback,i={},t={},s={},a={dimension:["qDim.qFieldDefs"],measure:["qMeasure.qDef","qMeasure.qLabel","qMeasure.qLabelExpression","qMeasure.coloring","qMeasure.qNumFormat","qMeasure.isCustomFormatted"]};function u(e){var r={},n=o.getValue(e,"qInfo.qType");return n&&a[n]&&a[n].forEach((function(n){r[n]=o.getValue(e,n)})),JSON.stringify(r)}function l(e){var r=e.qInfo.qId;if(i[r]){var t=u(e);i[r].properties!==t&&(i[r].properties=t,"function"==typeof n&&i[r].enabled&&n(e)),i[r].enabled=!0}}function c(e,n){return r.app[n](e).then((function(r){i[e]={listener:r.layoutSubscribe(l),enabled:!1,properties:u(r.layout)}}))}return{subscribe:function(e){var n=e.measureLibraryIds,o=e.dimensionLibraryIds,a=[];return function(e){var r=e.measureLibraryIds,n=e.dimensionLibraryIds;t={},r.forEach((function(e){t[e]=!0})),s={},n.forEach((function(e){s[e]=!0}))}({measureLibraryIds:n,dimensionLibraryIds:o}),Object.keys(i).forEach((function(e){t[e]||s[e]||(i[e].listener.dispose(),delete i[e])})),r.app&&(Object.keys(t).forEach((function(e){t[e]&&!i[e]&&a.push(c(e,"getMeasure"))})),Object.keys(s).forEach((function(e){s[e]&&!i[e]&&a.push(c(e,"getDimension"))}))),Promise.all(a)},unsubscribe:function(){Object.keys(i).forEach((function(e){i[e].listener.dispose()})),i={}}}}var ce={getExpression:function(e){return o.getValue(e,"qDef.base.qDef")||o.getValue(e,"qDef.qDef")},getExpressionRef:function(e){return o.getValue(e,"qDef.base.qDef")?"qDef.base.qDef":"qDef.qDef"},getLibraryIdRef:function(e){return o.getValue(e,"qDef.base.qLibraryId")?"qDef.base.qLibraryId":"qLibraryId"},getLibraryId:function(e){return o.getValue(e,"qDef.base.qLibraryId")||o.getValue(e,"qLibraryId")},getLabelRef:function(e){return o.getValue(e,"qDef.base")?"qDef.base.qLabel":"qDef.qLabel"},getLabelExpressionRef:function(e){return o.getValue(e,"qDef.base")?"qDef.base.qLabelExpression":"qDef.qLabelExpression"}},pe={initBase:function(e,r){(r||pe.isValid(e))&&(o.setValue(e,"qDef.base.qDef",o.getValue(e,"qDef.qDef")),o.setValue(e,"qDef.base.qLibraryId",o.getValue(e,"qLibraryId")),o.setValue(e,"qDef.base.qLabel",o.getValue(e,"qDef.qLabel")),o.setValue(e,"qDef.base.qLabelExpression",o.getValue(e,"qDef.qLabelExpression")))},restoreBase:function(e){pe.isValid(e)&&(o.setValue(e,"qDef.qDef",o.getValue(e,"qDef.base.qDef")),o.setValue(e,"qLibraryId",o.getValue(e,"qDef.base.qLibraryId")),o.setValue(e,"qDef.qLabel",o.getValue(e,"qDef.base.qLabel")),o.setValue(e,"qDef.qLabelExpression",o.getValue(e,"qDef.base.qLabelExpression")),o.getValue(e,"qDef.qAggrFunc")&&o.getValue(e,"qDef.base.qAggrFunc")&&o.setValue(e,"qDef.qAggrFunc",o.getValue(e,"qDef.base.qAggrFunc")),delete e.qDef.base)},isValid:function(e){var r=o.getValue(e,"qDef.base.qDef"),n=o.getValue(e,"qDef.base.qLibraryId");return void 0!==r||void 0!==n}},fe=pe;function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var de={accumulation:j,movingAverage:W,difference:z,normalization:ue},ye=(r.default={modifiers:de,apply:ge,applyModifiers:be,cleanUpMeasure:ve,destroy:function(e){e&&ye[e.id]&&ye[e.id].masterItemSubscriber&&(ye[e.id].masterItemSubscriber&&ye[e.id].masterItemSubscriber.unsubscribe(),delete ye[e.id])},hasActiveModifiers:De,getActiveModifier:qe,initBase:fe.initBase,isSupportedModifiers:function(e){return Array.isArray(e)&&e.some((function(e){return de[e]}))},isApplicableSupportedModifiers:function(e){var r=e.modifierTypes,n=e.properties,i=e.layout;return Array.isArray(r)&&r.some((function(e){return de[e]&&de[e].isApplicable({properties:n,layout:i})}))},measureBase:ce,limitedSorting:function(e){var r=e.measures,n=e.properties,i=e.layout,t=!1,o=!1;return r.forEach((function(e){var r=Ae(e);Ce({modifiers:r,properties:n,layout:i})&&(t=!0,o=o||Te({modifiers:r,properties:n,layout:i}))})),t&&!o},ifEnableTotalsFunction:he},{});function ge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.model,n=e.properties,i=e.isSnapshot,s=void 0!==i&&i,a=e.masterItem;ye[r.id]=ye[r.id]||{isFirstTime:!0};var u=ye[r.id].isFirstTime;if(ye[r.id].isFirstTime=!1,n&&"object"===me(n))return be({model:r,properties:n});var l=r?r.layout:void 0,c=o.getValue(l,"qSelectionInfo.qInSelections");if(s||c)return Promise.resolve(!1);var p=o.getValue(l,"qHyperCube.qMeasureInfo"),f=ye[r.id].lastReloadTime;if(ye[r.id].lastReloadTime=o.getValue(r,"app.layout.qLastReloadTime"),De({measures:p,layout:l})){var m=function(e){var r=e.measures,n=e.layout,i=e.model,t=e.lastReloadTime;return o.getValue(i,"app.layout.qLastReloadTime")!==t&&function(e){var r=e.measures,n=e.properties,i=e.layout;if(!Array.isArray(r))return!1;return r.some((function(e){return Ne({measure:e,properties:n,layout:i})}))}({measures:r,layout:n})}({measures:p,layout:l,model:r,lastReloadTime:f});return m||function(e){var r=e.measures,n=e.layout,i=e.masterItem,t=e.isFirstTime;if(!Array.isArray(r))return!1;return t||i||r.some((function(e){return function(e){var r=e.measure,n=e.layout;if(Ce({modifiers:Ae(r),layout:n}))return!r.base;return!!r.base}({measure:e,layout:n})}))}({measures:p,layout:l,masterItem:a,isFirstTime:u})?r.getEffectiveProperties().then((function(e){var n=t()(!0,{},e);Se(n);var i=Pe(n);return Fe({model:r}).then((function(t){return we({libraryIds:i,model:r}).then((function(i){return m&&function(e){var r=e.properties;Ee(r).forEach((function(e){return function(e){var r=e.measure,n=e.properties;if(Ne({measure:r,properties:n})){var i=0,t=r.qDef.modifiers;Array.isArray(t)&&t.forEach((function(e){if("object"===me(e)&&!e.disabled){if(i++,"object"!==me(de[e.type]))throw new Error('Modifier "'.concat(e.type,'" is not available'));if(i>1)throw new Error("More than 1 modifier on a measure! (not yet supported)");var n=de[e.type].extractInputExpression({outputExpression:r.qDef.qDef,modifier:e});void 0!==n&&Le(r)&&h.simplifyExpression(r.qDef.base.qDef)!==h.simplifyExpression(n)&&(r.qDef.base.qDef=n)}}))}}({measure:e,properties:r})}))}({properties:n}),be({model:r,oldProperties:e,properties:n,runUpdateIfChange:!0,masterItem:a,libraryItemsProps:i,dimensionAndFieldList:t})}))}))})):Promise.resolve(!1)}return function(e){if(!Array.isArray(e))return!1;return e.some((function(e){return"object"===me(e.base)}))}(p)?r.getEffectiveProperties().then((function(e){return function(e){var r=e.model,n=e.properties,i=Pe(n);return Re({model:r,libraryIds:i}).then((function(){var e=t()(!0,{},n);return Ee(n).forEach((function(e){return ve(e)})),Me({oldProperties:e,newProperties:n,model:r})}))}({model:r,properties:e})})):Promise.resolve(!1)}function be(e){var r=e.model,n=e.oldProperties,i=e.properties,s=e.measures,a=e.runUpdateIfChange,u=void 0!==a&&a,l=e.masterItem,c=e.libraryItemsProps,p=e.dimensionAndFieldList;void 0===n&&(n=u?t()(!0,{},i):i),Se(i);var f=Pe(i);return Re({model:r,libraryIds:f,masterItem:l}).then((function(){return function(e){var r=e.measures,n=e.properties,i=e.model,s=e.libraryItemsProps,a=e.dimensionAndFieldList;r||(r=Ee(n));if(!r.length)return Promise.resolve();if(!De({measures:r,properties:n}))return r.forEach((function(e){return ve(e)})),Promise.resolve();var u=s?void 0:Pe(n);return Fe({model:i,dimensionAndFieldList:a}).then((function(e){return we({libraryIds:u,model:i,libraryItemsProps:s}).then((function(i){r.forEach((function(r){Ce({modifiers:r.qDef.modifiers,properties:n})?(!function(e){var r=e.measure,n=e.properties,i=e.libraryItemsProps,s=e.dimensionAndFieldList,a=0;fe.isValid(r)||fe.initBase(r,!0);var u=r.qDef,l=u.modifiers,c=u.base;Array.isArray(l)&&l.forEach((function(e){if("object"===me(e)&&!e.disabled){if(a++,"object"!==me(de[e.type]))throw new Error('Modifier "'.concat(e.type,'" is not available'));if(a>1)throw new Error("More than 1 modifier on a measure! (not yet supported)");de[e.type].initModifier(e);var u=r.qLibraryId||c&&c.qLibraryId;u?function(e){var r=e.measure,n=e.modifier,i=e.libraryId,o=e.properties,s=e.libraryItemsProps,a=e.dimensionAndFieldList,u=s[i],l=u.qMeasure.qDef,c=de[n.type].generateExpression({expression:l,modifier:n,properties:o,dimensionAndFieldList:a});n.outputExpression=c,r.qDef.qDef=n.outputExpression,(r.qDef.qLabel||u.qMeasure.qLabel)&&(r.qDef.qLabel=u.qMeasure.qLabel);(r.qDef.qLabelExpression||u.qMeasure.qLabelExpression)&&(r.qDef.qLabelExpression=u.qMeasure.qLabelExpression);r.qDef.quarantine&&r.qDef.quarantine.qNumFormat&&u.qMeasure.qNumFormat&&(r.qDef.qNumFormat=u.qMeasure.qNumFormat,r.qDef.isCustomFormatted=u.qMeasure.isCustomFormatted);delete r.qLibraryId,r.qDef.coloring=u.qMeasure.coloring,n.base=t()(!0,{},r.qDef.base)}({measure:r,modifier:e,libraryId:u,properties:n,libraryItemsProps:i,dimensionAndFieldList:s}):function(e){var r=e.measure,n=e.modifier,i=e.properties,o=e.dimensionAndFieldList;"function"==typeof de[n.type].updateModifier&&de[n.type].updateModifier(n,i.qHyperCubeDef);var s=ce.getExpression(r),a=de[n.type].generateExpression({expression:s,modifier:n,properties:i,dimensionAndFieldList:o});n.outputExpression=a,r.qDef.qDef=n.outputExpression,r.qDef.base.qLabelExpression?r.qDef.qLabelExpression=r.qDef.base.qLabelExpression:r.qDef.qLabel=r.qDef.base.qLabel||s;n.base=t()(!0,{},r.qDef.base)}({measure:r,modifier:e,properties:n,dimensionAndFieldList:s}),function(e){var r=o.getValue(e,"qDef.qAggrFunc");"Expr"!==r||he(e)?"None"!==r?delete e.qDef.base.qAggrFunc:"None"===r&&he(e)&&"Expr"===e.qDef.base.qAggrFunc&&(e.qDef.qAggrFunc="Expr",delete e.qDef.base.qAggrFunc):(e.qDef.qAggrFunc="None",e.qDef.base.qAggrFunc="Expr")}(r)}}))}({measure:r,properties:n,libraryItemsProps:i,dimensionAndFieldList:e}),xe(r)):ve(r)}))}))}))}({measures:s,properties:i,model:r,libraryItemsProps:c,dimensionAndFieldList:p}).then((function(){return u?Me({oldProperties:n,newProperties:i,model:r}):Promise.resolve(!1)}))}))}function ve(e){!function(e){var r=Ae(e);return Array.isArray(r)&&r.some((function(e){return"object"===me(e)&&!e.disabled&&!de[e.type]}))}(e)?fe.restoreBase(e):delete e.qDef.base,e.qDef.coloring&&delete e.qDef.coloring,xe(e)}function De(e){var r=e.measures,n=e.properties,i=e.layout;return!!Array.isArray(r)&&r.some((function(e){return Ce({modifiers:Ae(e),properties:n,layout:i})}))}function qe(e){var r=Ae(e);if(Array.isArray(r))for(var n=0;n<r.length;n++){var i=r[n];if(de[i.type]&&!i.disabled)return i}}function he(e){var r=qe(e);return!r||de[r.type].enableTotalsFunction(e)}function Ee(e){return o.getValue(e,"qHyperCubeDef.qMeasures",[]).concat(o.getValue(e,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures",[]))}function Ae(e){return e.modifiers||e.qDef&&e.qDef.modifiers}function Ie(e){return o.getValue(e,"outputExpression.qValueExpression.qExpr")||o.getValue(e,"outputExpression")}function Se(e){Ee(e).forEach((function(e){return function(e){var r=qe(e);r&&(void 0!==r.outputExpression&&Ie(r)!==e.qDef.qDef?delete e.qDef.base:!fe.isValid(e)&&r.base&&(e.qDef.base=t()(!0,{},r.base)))}(e)}))}function xe(e){var r=Ae(e);Array.isArray(r)&&r.forEach((function(r){"object"===me(r)&&(r.disabled||!de[r.type]&&Ie(r)!==e.qDef.qDef)&&(r.disabled=!0,delete r.base)}))}function Le(e){return e.base||e.qDef&&e.qDef.base}function Ve(e){var r=Le(e);return e.qLibraryId||r&&r.qLibraryId}function Ne(e){var r=e.measure,n=e.properties,i=e.layout;return!Ve(r)&&Ce({modifiers:Ae(r),properties:n,layout:i})}function Ce(e){var r=e.modifiers,n=e.properties,i=e.layout,t={};return Array.isArray(r)&&r.some((function(e){return!("object"!==me(e)||e.disabled||!de[e.type])&&(void 0===t[e.type]&&(t[e.type]=de[e.type].isApplicable({properties:n,layout:i})),t[e.type])}))}function Fe(e){var r=e.model,n=e.dimensionAndFieldList;if(n)return Promise.resolve(n);var i=[],t={},o=r.app.getDimensionList().then((function(e){t.dimensionList=e}));i.push(o);var s=r.app.getFieldList().then((function(e){t.fieldList=e}));return i.push(s),Promise.all(i).then((function(){return t}))}function we(e){var r=e.libraryIds,n=e.model,i=e.libraryItemsProps;if(i)return Promise.resolve(i);var t=r.measureLibraryIds,o=r.dimensionLibraryIds,s={},a=[];return t.forEach((function(e){var r=n.app.getMeasure(e).then((function(r){return r.getProperties().then((function(r){s[e]=r}))}));a.push(r)})),o.forEach((function(e){var r=n.app.getDimension(e).then((function(r){return r.getProperties().then((function(r){s[e]=r}))}));a.push(r)})),Promise.all(a).then((function(){return s}))}function Oe(e,r){if(""!==r||-1===["qFmt","qDec","qThou"].indexOf(e))return r}function Me(e){var r=e.oldProperties,n=e.newProperties,i=e.model,t=JSON.stringify(o.getValue(r,"qHyperCubeDef.qMeasures"),Oe)!==JSON.stringify(o.getValue(n,"qHyperCubeDef.qMeasures"),Oe)||JSON.stringify(o.getValue(r,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures"),Oe)!==JSON.stringify(o.getValue(n,"qHyperCubeDef.qLayoutExclude.qHyperCubeDef.qMeasures"),Oe);return t?function(e){var r=e.model,n=e.oldProperties,i=e.newProperties,t=r.layout;return t&&!t.qHasSoftPatches&&!t.qExtendsId&&o.getValue(t,"qMeta.privileges",[]).indexOf("update")>-1?r.setProperties(i):O.saveSoftProperties(r,n,i)}({model:i,oldProperties:r,newProperties:n}).then((function(){return t})):Promise.resolve(t)}function Te(e){var r=e.modifiers,n=e.properties,i=e.layout;return Array.isArray(r)&&r.some((function(e){return"object"===me(e)&&!e.disabled&&de[e.type]&&de[e.type].needDimension({modifier:e,properties:n,layout:i})}))}function Pe(e){var r=Ee(e),n=[],i=[],t=!1;return r.forEach((function(r){var i=Ae(r);if(Ce({modifiers:i,properties:e})){var o=Ve(r);o&&n.push(o),t=t||Te({modifiers:i,properties:e})}})),o.getValue(e,"qHyperCubeDef.qDimensions",[]).forEach((function(e){var r=e.qLibraryId;r&&i.push(r)})),{measureLibraryIds:n,dimensionLibraryIds:i}}function Re(e){var r=e.model,n=e.libraryIds;return!e.masterItem&&n&&(n.measureLibraryIds.length||n.dimensionLibraryIds.length)?(ye[r.id].masterItemSubscriber=ye[r.id].masterItemSubscriber||le({model:r,callback:function(e){return ge({model:r,masterItem:e}).then((function(){return r.app.clearUndoBuffer()}))}}),ye[r.id].masterItemSubscriber.subscribe(n)):Promise.resolve()}}])}))}}]);