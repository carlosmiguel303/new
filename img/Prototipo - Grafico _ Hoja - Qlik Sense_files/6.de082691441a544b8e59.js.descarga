/*! For license information please see 6.de082691441a544b8e59.js.LICENSE.txt */
/*!
 * sense-client@7.144.6
 * 
 * Copyright(C) 2021 Qlik International AB
 * All Rights Reserved
 * 
 */
(window["qJsonp"]=window["qJsonp"]||[]).push([[6],{"7xom":function(e,t,a){"use strict";t["a"]={isByNthDimension:i,useFallback:n};function r(e){return void 0!==e&&-1!==e}function i(e){return"byDimension"===e.mode&&e.byDimDef&&r(e.byDimDef.activeDimensionIndex)}function n(e,t){var a=true;var r=t.auto||i(t);return a&&r}},oRmM:function(e,t,a){"use strict";var r=a("GF7R");var i=a("qrwB");function n(e,t){return r["a"].toHex(r["a"].blend(e,t,.5))}function o(e,t,a){if(e.length!==t.length+1||t.length!==a.length)return false;var r=[e[0]];var i=[];var o=t.length;var s;for(s=0;s<o;s++)if(t[s]){r.push(n(e[s],e[s+1]));r.push(n(e[s],e[s+1]));i.push(a[s]);if(s!==o-1){r.push(e[s+1]);r.push(e[s+1]);i.push((a[s]+a[s+1])/2)}}else{r.push(e[s]);r.push(e[s+1]);i.push(a[s]);if(s!==o-1&&t[s+1]){r.push(e[s+1]);r.push(e[s+1]);i.push((a[s]+a[s+1])/2)}}r.push(e[s]);return{colors:r.reverse(),limits:i}}function s(e,t,a,r){var i=e.getLegendParts(0);var n=[];var o=t.max-t.min;if(Number.isNaN(+o))return n;var s;var l;var u=t.max;var h;for(var c=0;c<i.length;c++){s=i[c];if(r)h=c===i.length-1?t.min:r[i.length-1-c-1];else{l=(s.limits[1]-s.limits[0])*o;h=u-l}s.isMax=0===c;s.max=a.formatValue(s.isMax?t.max:u);s.min=a.formatValue(c+1===i.length?t.min:h);s.id=[];s.id[0]=s.isMax?t.max:u;s.id[1]=c===i.length-1?t.min:h;s.type="range";u=h;n.push(s)}return n}function l(e,t){var a;var r;var n=new i["a"];var o;if(t)for(r=0;r<e.length;r++){o=e[r];if(o)for(a=0;a<o.length;a+=2)n.addColorPart(o[a],o[a+1],r)}else for(a=0;a<e.length;a+=2)n.addColorPart(e[a],e[a+1]);return n}t["a"]={setupColors:o,setupLegend:s,createColorScale:l}},xnZp:function(e,t,a){"use strict";var r=a("6uJb");var i=a("SOxp");var n=a("sWge");var o=a("ekpb");var s=-3;var l=-2;function u(e,t){var a=[];var i={};var n;var u;var h;var c=this._qDataObject;var f=this._legendMarker?this._legendMarker:"rect";var m=c?c.qDimensionInfo instanceof Array?c.qDimensionInfo:[c.qDimensionInfo]:null;var d;var p=this._colorMap;var v;t=void 0===t?m.length-1:t[0];var _=this._dimensionTree;if(e){h=c.qMeasureInfo;d=h.length;for(var g=0;g<d;g++)a.push({label:h[g].qFallbackTitle,color:p.getColor(0,0,g),id:[-1],type:"measure",marker:this._legendMarker?this._legendMarker:this._measureLegendTypes&&this._measureLegendTypes[g]||"box"})}else o["a"].each.call(_,(function(e){v=o["a"].getLevel.call(e);if(v-1===t&&e.data.qElemNo!==l&&void 0!==e.data.qText&&void 0===i[e.data.qElemNo]){u=[];u[t]=e.data.qElemNo;n={label:e.data.qElemNo!==s||void 0!==e.data.qText?e.data.qText:r["default"].get("properties.dimensionLimits.others"),color:p.getColorFromPreScaledValue(e.data.qElemNo),id:[e.data.qElemNo],index:e.data.rowIndex,type:e.data.qElemNo!==s?"dimension":"others",marker:f};a.push(n);i[e.data.qElemNo]=n}}));return a}function h(e,t){var a=[];var r={};var i=this._data.qListObject.qDataPages[0].qMatrix;var n;var o;var u=this._qDataObject;var h=u?u.qDimensionInfo instanceof Array?u.qDimensionInfo:[u.qDimensionInfo]:null;var c;var f;var m;var d;var p;var v=this._colorMap;t=void 0===t?h.length-1:t[0];if(e){n=this._data.qListObject.qMeasureInfo;o=n.length;for(f=0;f<o;f++)a.push({label:n[f].qFallbackTitle,color:v.getColor(0,0,f),id:[-1],type:"measure"})}else for(c=0;c<i.length;c++){m=i[c][t];if(m.qElemNumber!==s&&m.qElemNumbero!==l&&void 0===r[m.qText]){d=[];d[t]=m.qElemNumber;p={label:m.qText,color:v.getColor(d,0,0,c),id:[m.qElemNumber],type:"dimension"};a.push(p);r[m.qText]=p}}return a}function c(e){return"".concat(e.discrete,",").concat(e.boxType,",").concat(e.colorMode)}var f=i["a"].extend({init:function e(t){this._data=t;this._colorMappings={}},setColorMap:function e(t){this._colorMap=t},getColorMap:function e(){return this._colorMap},getColorMapping:function e(){if(!this._colorMap||!this._data)return[];var t;var a=this._colorMap.getColorDataInfo().legendMode;if("primary"===a.colorMode)return[];if(this._colorMappings[c(a)])return this._colorMappings[c(a)];t=a.discrete&&"range"===a.boxType||!a.discrete?this._colorMap.generateScaleBasedMapping():this._data.qListObject?h.apply(this,["measure"===a.colorMode,this._colorMap.getDimensionIndex()]):u.apply(this,["measure"===a.colorMode,this._colorMap.getDimensionIndex()]);this._colorMappings[c(a)]=t;return t},setData:function e(t){var a=t.qHyperCube?t.qHyperCube:t.qListObject;var r=t.qHyperCube?t.qHyperCube.qDimensionInfo:[t.qListObject.qDimensionInfo];this._qDataObject=a;this._data=t;t&&a.qDataPages.length?this._others=a.qDataPages[0].qMatrix.some((function(e){return r&&r.length&&true===e[r.length-1].qIsOtherCell})):this._others=false;this._colorMappings={}},setDimensionTree:function e(t){this._dimensionTree=t;this._colorMappings={}},setMeasureLegendTypes:function e(t){this._measureLegendTypes=t},setLegendMarker:function e(t){this._legendMarker=t},getLegendMarker:function e(){return this._legendMarker},release:function e(){this._colorMap=null;this._dimensionTree=null;this._data=null;this._qDataObject=null}});var m=f;var d=a("UV1h");var p=a("WCAk");var v=a("qIEf");var _=a.n(v);var g=a("oRmM");var M=a("45bU");function q(e,t,a,r,i){var n=0;var o=[];var s;var l;var u;var h=(e-t)/(r+1);if(0===h)return 1;for(s=0;s<a.length;s++){l=.99*(a[s]-t);u=a[s]>e?Math.floor(e/h):a[s]<t?0:Math.floor(l/h);if(Number.isNaN(+u))continue;o[u]?o[u]++:o[u]=1}for(s=0;s<o.length;s++)o[s]&&n++;if(n<=r||n>=i)return Math.max(n,r);return q(e,t,a,++r,i)}function C(e){var t=[];var a;for(a=0;a<e.length;a++)e[a]?t.push(b(e[a],false)):t.push(null);return t}function b(e,t){var a=1;var r=[];r.push(e[0]);t||r.push(e[0]);for(;a<e.length-1;a++){r.push(e[a]);r.push(e[a])}if(a<e.length){r.push(e[a]);t||r.push(e[a])}return r}function x(e,t,a){var r={limits:[],colors:[]};var i=false;e.forEach((function(n,o){if(n>a.min&&!i)if(n<a.max){r.limits.push(n);r.colors.push(t[o]);o===e.length-1&&(i=true)}else if(n>a.max){if(e.indexOf(n)===o){r.colors.push(t[o]);i=true}}else if(n===a.max&&e.indexOf(n)===o){r.colors.push(t[o]);r.limits.push(n);i=true}i&&a.max>=n&&r.colors.push(t[o+1]);o!==e.length-1||i||r.colors.push(t[o+1])}));0===e.length&&r.colors.push(t[0]);return r}function D(e){this._sequentialScales={};var t=this._sequentialScales;var a=0;e.scales.forEach((function(e){t[e.propertyValue]={type:e.type,scale:g["a"].createColorScale("class-pyramid"===e.type?C(e.scale):b(e.scale,"gradient"===e.type),"class-pyramid"===e.type)};a=Math.max(e.scale.length,a)}));this._largestScaleSize=a;this._wrangled=[];this._defaultScaleObj=this._sequentialScales[e.scales[0].propertyValue];this._activeScale=this._defaultScaleObj.scale}var y=i["a"].extend({init:function e(t,a,r){D.call(this,d["a"]);this.app=r;this._themeChangeWatcher=function(){D.call(this,d["a"])}.bind(this);d["a"].ThemeChanged.bind(this._themeChangeWatcher);this._measure=0;this.minMax={min:null,max:null};this.setData(t)},release:function e(){d["a"].ThemeChanged.unbind(this._themeChangeWatcher)},setData:function e(t,a,r){this._data=t;this._colorDataInfo=a;this._customScale=false;this._invalidSpan=false;var i=this;var o;var s;i._unscaledLimits=null;function l(){i._activeScale.setMaxMinValues(o.max,o.min);void 0!==s.reverseScheme&&i._activeScale.setReverse(true===s.reverseScheme)}function u(e){return e.some((function(e){return e}))}function h(e){e&&(u(e.breakTypes)?f(e):c(e))}function c(e){if(e){var t=e.colors.map((function(e){return d["a"].resolveColor(e)}));var a=e.limits;var r=null;var n;var s;var l={min:o.min,max:o.max};if("absolute"===e.limitType){r=x(a,t,l);a=r.limits;var u=l.max-l.min;var h=.001*u;i._unscaledLimits=a.concat();a.length&&a[0]===l.min&&(o.min=l.min-h);a.length&&a[a.length-1]===l.max&&(o.max=l.max+h);var c=o.max-o.min;a=l.min===l.max?a.map((function(e){return(e-l.min)/l.min})):a.map((function(e){return(e-l.min)/(l.max-l.min)}));for(var f=0;f<a.length;f++)0!==c&&c!==u&&(a[f]*=u/(c+h*(1-(f+1)/a.length)));n=a.map((function(){return false}))||a.map((function(){return 0}));s=g["a"].setupColors(r.colors,n,a)}else if("percent"===e.limitType)if(l.min===l.max)s=g["a"].setupColors([t[0]],[],[]);else{a=a.map((function(e){return Math.max(Math.min(e,1),0)}));n=e.breakTypes||a.map((function(){return 0}));s=g["a"].setupColors(t,n,a)}if(s){i._activeScale=g["a"].createColorScale(s.colors,false);i._activeScale.setLimits(s.limits);i._customScale=true;i._classes=true}}i._measureGradient=e}function f(e){if(e){var t=e.colors.map((function(e){return d["a"].resolveColor(e)}));var a=e.limits;if("absolute"===e.limitType){o.max=Math.max(o.max,a[a.length-1]);o.min=Math.min(o.min,a[0]);a=o.max===o.min?a.map((function(e){return(e-o.min)/o.max})):a.map((function(e){return(e-o.min)/(o.max-o.min)}))}var r=e.breakTypes||a.map((function(){return 0}));var n=g["a"].setupColors(t,r,a);if(n){i._activeScale=g["a"].createColorScale(n.colors,false);i._activeScale.setLimits(n.limits);i._customScale=true;i._classes=false}}i._measureGradient=e}if(t){if(!a.valid){this._legendTitle="";this._wrangled=[];return}s=t.color||{};var m=t.qHyperCube?t.qHyperCube:t.qListObject;this._qDataObject=m;this._validColorInformation=this._colorDataInfo.valid&&!this._colorDataInfo.allNaN;this._byExpression="byExpression"===s.mode;this._legendTitle=this._colorDataInfo.legendTitle;if(void 0!==s.measureScheme){var p=this._sequentialScales[s.measureScheme]||this._defaultScaleObj;this._activeScale=p.scale;this._classes="class-pyramid"===p.type;o=this._getMinMax();this._invalidSpan=!o;if(!this._invalidSpan&&this._validColorInformation){this._wrangled=this._colorDataInfo.wrangled.map((function(e){return e.elemValue}));this._numUsedColors=this._colorDataInfo.persistentColors?[Math.min(this.getLargestScaleSize(),this._colorDataInfo.dimSize)]:[q(o.max,o.min,this._wrangled,1,this.getLargestScaleSize())];if(a.attrInfo&&a.useMeasureGradient){if(r&&r.content&&r.content.chartData)return n["a"].resolve(r.content.chartData.measureGradient).then(h).then(l);return M["a"].getMeasureGradient(a.attrInfo.colorMapRef,this.app).then(h).then(l)}l()}}}return},getColor:function e(t,a,r,i){i=this._byExpression||void 0===this._wrangled[a]?i:this._wrangled[a];if(!this._byExpression&&(this._invalidSpan||Number.isNaN(+i)||!this._validColorInformation))return p["a"].retriveColor(d["a"].dataColors.nullColor);return this._activeScale.getColor(i,this._getNumUsedColors(0))},getColorFromPreScaledValue:function e(t){return this._activeScale.getColor(t,this._getNumUsedColors(0))},getActiveScale:function e(){return this._activeScale},getLargestScaleSize:function e(){return this._largestScaleSize||0},generateScaleBasedMapping:function e(){var t;var a=this.getValueFormatter();var r=this._activeScale;this.minMax=this._getMinMax();var i=this.minMax;if(this._customScale)return g["a"].setupLegend(r,i,a,this._unscaledLimits);var n=[];var o=r.getLegendParts(this._getNumUsedColors(0));if(!i)return n;var s=i.max-i.min;if(Number.isNaN(+s))return n;var l=o.length;var u=s/l;var h=i.max;var c;if(!Number.isNaN(+i.measureMax)&&this._classes){c=_.a.extend(true,{},o[0]);c.isMax=true;c.min=a.formatValue(h);c.id=[i.measureMax,h];c.type="range";n.push(c)}for(t=0;t<l-1;t++){c=o[t];c.isMax=0===t;c.max=a.formatValue(h);c.min=a.formatValue(h-u);c.id=[h,h-u];c.type="range";h-=u;n.push(c)}c=o[t];c.isMax=0===t;c.max=a.formatValue(h);c.min=a.formatValue(i.min);c.id=[h,i.min];c.type="range";n.push(c);if(!Number.isNaN(+i.measureMin)&&this._classes){c=_.a.extend(true,{},o[t]);c.isMax=0===t;c.max=a.formatValue(i.min);c.min=void 0;c.id=[i.min,i.measureMin];c.type="range";n.push(c)}return n},getColorMapping:function e(){return this.generateScaleBasedMapping()},getLegendMode:function e(){return[this._classes?"box":"scale",this._classes?"range":"item","measure"]},getLegendTitle:function e(){return this._legendTitle},setMeasureFormatters:function e(t){this._measureFormatters=t},setGenericFormatter:function e(t){this._formatter=t},getValueFormatter:function e(){if(this._measureFormatters&&this._measureFormatters[0]&&!this._byExpression)return this._measureFormatters[0];return{formatValue:function e(t){return t}}},_getMinMax:function e(){var t;if(false===this._data.color.autoMinMax){t={min:this._data.color.measureMin||0,max:this._data.color.measureMax||0};return t.max>=t.min?t:null}if(this._validColorInformation&&this._colorDataInfo.minMax){t=this._colorDataInfo.minMax;return t}return null},_getNumUsedColors:function e(t){return this._numUsedColors?this._numUsedColors[t]:0},calculateNumberOfUsedColors:q,filterLimitsAndColorsBasedOnMinMax:x,getMeasureGradient:function e(){return this._measureGradient}});var I=y;var S=-3;var E=-2;function N(e,t,a){if(t===a)return[e];var r=[];"U"!==e.qType&&"O"!==e.qType&&"T"!==e.qType&&e.qSubNodes.forEach((function(e){r=r.concat(N(e,t+1,a))}));return r}function T(e){return e.some((function(e){return e.qElemNumber===E||e.qElemNumber===S}))}function V(e,t,a,r){e[t]={};e[t].elemValue=a[r];e[t].text=a.qText}function L(e,t,a,r,i,n){t=t||0;a=a||0;n=n||a;var o;var s=0;var l=[];var u=[];if(e){if(e.qDataPages[0]){var h=e.qDataPages[0].qMatrix;s=e.qDataPages[0].qArea.qTop||s;h.forEach((function(e,t){!i&&T(e)||(u[t]=e[a])}));o=i?r?"qElemNo":"qElemNumber":"qNum"}else if(e.qStackedDataPages[0]){var c=e.qStackedDataPages[0].qData[0];u=N(c,0,a+1);var f=[];if(n>a)u.forEach((function(e){var t=N(e,0,n-a);t.forEach((function(t){f[t.qRow]=e}))}));else{f=[];u.forEach((function(e){f[e.qRow]=e}))}u=f;o=i?"qElemNo":r?"qNum":"qValue"}r?u.forEach((function(e,a){V(l,s+a,e[r].qValues[t],o)})):u.forEach((function(e,t){V(l,s+t,e,o)}))}return l}var w={wrangleData:L};var P=a("fwzx");var A=a("RM7h");function F(e,t){var a=-Number.MAX_VALUE;var r=Number.MAX_VALUE;var i;var n=true;if(false===t.color.autoMinMax)return{min:t.color.measureMin||0,max:t.color.measureMax||0};if(e){e.forEach((function(e){i=e.value;if(!Number.isNaN(+i)){a=Math.max(a,i);r=Math.min(r,i);n=false}}));if(n)return null;return{min:r,max:a}}return null}function k(e){var t=[];e.forEach((function(e,a){t[a]={color:p["a"].retriveColor(Number.isNaN(+e.elemValue)?e.text:e.elemValue,"argb"),value:e.elemValue}}));return t}var O=I.extend({init:function e(t,a,r){this._formatter=new A["a"](null);this._super(t,a,r)},setData:function e(t,a,r){this._precalculate(t);var i=this._super(t,a,r?{content:{chartData:r}}:t?t.snapshotData:null);if(t)if(this._byExpression){if(!this._wrangledMapping.length||!this._minMax)return;var n=this._wrangledMapping;this._numUsedColors=[this.calculateNumberOfUsedColors(this._minMax.max,this._minMax.min,n.map((function(e){return e.value})),1,this.getLargestScaleSize())];this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,true);this._formatter.prepare();this._activeScale.setMaxMinValues(this._minMax.max,this._minMax.min)}else{this._minMax=null;this._mapping=null;this._formatter.pattern=this._formatter.createPatternFromRange(0,1,true);this._formatter.prepare()}return i},getColor:function e(t,a,r,i){if(!this._byExpression)return this._super(t,a,r,i);var n;var o=this._wrangledMapping?this._wrangledMapping[a]:null;if(!o||o.color.isInvalid()&&this._isColorExpression)return p["a"].retriveColor(d["a"].dataColors.nullColor);n=this._isColorExpression?o.color:this._super(t,a,0,o.value);return n},getExpressionValue:function e(t){if(!this._wrangledMapping[t]||this._isColorExpression)return;return this._wrangledMapping[t].value},getLegendTitle:function e(){if(!this._byExpression)return this._super();return this._expressionLabel},getLegendMode:function e(){if(this._byExpression){if(this._isColorExpression)return["box","item","primary",true];return[this._classes?"box":"scale",this._classes?"range":"item","measure",true]}return this._super()},getValueFormatter:function e(){if(this._colorDataInfo&&this._colorDataInfo.altMode&&void 0!==this._colorDataInfo.matchingDataMeasure)return this._measureFormatters&&this._measureFormatters[this._colorDataInfo.matchingDataMeasure]?this._measureFormatters[this._colorDataInfo.matchingDataMeasure]:this._formatter;if(this._byExpression||this._colorDataInfo&&this._colorDataInfo.altMode)return this._formatter;return this._measureFormatters&&this._measureFormatters[0]?this._measureFormatters[0]:this._formatter},setGenericFormatter:function e(t){this._super(t);if(this._byExpression&&this._minMax){this._formatter.pattern=this._formatter.createPatternFromRange(this._minMax.min,this._minMax.max,true);this._formatter.prepare()}else this._formatter.pattern=this._formatter.createPatternFromRange(0,1,true);this._formatter.prepare()},getGenericFormatter:function e(){return this._formatter},_getMinMax:function e(t,a){if(!this._byExpression)return this._super(t,a);if(this._minMax)return{min:this._minMax.min,max:this._minMax.max};return null},_precalculate:function e(t){this._wrangledMapping=[];if(t){var a=t.color||{};var i=t.qHyperCube?t.qHyperCube:t.qListObject;this._qDataObject=i;this._data=t;this._isColorExpression=false!==a.expressionIsColor;this._byExpression="byExpression"===a.mode;this._expressionLabel=a.expressionLabel&&""!==a.expressionLabel?a.expressionLabel:r["default"].get("Object.ChartTooltip.ColorExpression");if(this._byExpression){var n=-1;var o=-1;var s=false;i.qDimensionInfo.concat(i.qMeasureInfo).forEach((function(e,t){e.qAttrExprInfo&&e.qAttrExprInfo.every((function(e,a){if(e.id===P["a"].IDMAP.COLOR_BY_EXPRESSION&&!s){n=t;o=a;s=true;return false}return true}))}));if(n>=0&&o>=0){var l=w.wrangleData(i,o,n,"qAttrExps",false,i.qDimensionInfo.length-1,false);this._wrangledMapping=k(l);this._minMax=F(this._wrangledMapping,t)}}}}});var H=O;function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||false;r.configurable=true;"value"in r&&(r.writable=true);Object.defineProperty(e,r.key,r)}}function B(e,t,a){t&&z(e.prototype,t);a&&z(e,a);return e}var U="auto";var j="primary";var G="measure";var W="dim_master";var X="meas_master";var Y="multiple";var J=-2;var K;var Q;function Z(e,t){return d["a"].resolveColor(t||e)}function $(e,t){var a=t||0;var r=[];e.forEach((function(e){if(void 0===r[e]&&e>=0){r[e]=a;a++}}));return r}function ee(e){if(this._persistColors||this._measureMode)return e;return this._reMappedIndeces[e]}function te(){K={};d["a"].dataPalettes.forEach((function(e){K[e.propertyValue]={type:e.type,scale:e.scale}}));Q=K[d["a"].dataPalettes[0].propertyValue]}var ae=function(){function e(t,a){R(this,e);a=a||{};this._primaryColorMode=a.colorBy||U;this._autoMode=a.autoMode||U;this._primaryColor=d["a"].dataColors.primaryColor;this._persistColors=true;this._wrangled=[];this._dimIndex=0;te();this._themeChangeWatcher=function(){te()};d["a"].ThemeChanged.bind(this._themeChangeWatcher);t&&this.setData(t)}B(e,[{key:"release",value:function e(){d["a"].ThemeChanged.unbind(this._themeChangeWatcher)}},{key:"setData",value:function e(t,a){this._data=t;this._colorDataInfo=a;if(!a.valid){this._dimLabel="";this._wrangled=[];return}var i=t.color||{};var n=t.qHyperCube?t.qHyperCube:t.qListObject;var o=n&&n.qMeasureInfo?n.qMeasureInfo.length:0;this._colorMode=i.auto?U:i.mode||j;this._internalMode=this._colorDataInfo.internalMode;this._measureMode=this._internalMode===Y||"byMultiple"===this._colorMode||this._internalMode===X||this._internalMode===W;this._persistColors=this._colorDataInfo.persistentColors;this._dimIndex=this._colorDataInfo.dimIndex||0;this._measureMode?this._dimLabel=r["default"].get("Common.Measures"):this._dimLabel=this._colorDataInfo.legendTitle;this._wrangled=this._colorDataInfo.wrangled.map((function(e){return e.elemValue}));this._dimSize=this._measureMode?o:this._colorDataInfo.dimSize;this._persistColors||(this._reMappedIndeces=$(this._wrangled,this._colorDataInfo.top));this._primaryColor=Z(i.singleColor,i.paletteColor);"none"===this._primaryColor&&(this._primaryColor="rgba(0,0,0,0)");var s=this._colorDataInfo.dimensionScheme&&K[this._colorDataInfo.dimensionScheme]||Q;this._colorMode===U&&(s=Q);if("pyramid"===s.type){var l=Math.max(Math.min(s.scale.length-1,this._dimSize-1)%s.scale.length,0);this._qualitativeScale=s.scale[l]}else this._qualitativeScale=s.scale}},{key:"getColor",value:function e(t,a,r){var i=this._measureMode?r:this._wrangled[a];if(this._internalMode===j&&this._colorMode===U)return p["a"].retriveColor(d["a"].dataColors.primaryColor);if(this._internalMode===j)return p["a"].retriveColor(this._primaryColor);if(Number.isNaN(+i)||i===J)return p["a"].retriveColor(d["a"].dataColors.nullColor);i=ee.call(this,i);return p["a"].retriveColor(this._qualitativeScale[i%this._qualitativeScale.length])}},{key:"getLegendMode",value:function e(){var t=this._internalMode===j||this._internalMode===W?j:this._autoMode===G||this._measureMode?"measure":"dimension";return["box","item",t,"measure"===t]}},{key:"getColorFromPreScaledValue",value:function e(t){t=ee.call(this,t);return p["a"].retriveColor(this._qualitativeScale[t%this._qualitativeScale.length])}},{key:"getDimensionIndex",value:function e(){return this._colorDataInfo?this._dimIndex:0}},{key:"getLegendTitle",value:function e(){return this._dimLabel}}]);return e}();var re=ae;var ie=a("R2Yu");function ne(e,t){return'<div class="color-template-wrapper"><div class="color-dot" style="background:'.concat(t,'"></div><span dir="ltr">').concat(ie["a"].encodeForHTML(e),"</span></div>")}var oe={createLegendTemplate:ne};var se=-3;var le=-2;function ue(){this._colors={others:p["a"].retriveColor(d["a"].dataColors.othersColor),null:p["a"].retriveColor(d["a"].dataColors.nullColor),error:p["a"].retriveColor(d["a"].dataColors.errorColor)};this._wrangled=[]}ue.prototype.setProperties=function(e,t){this._dimIndex=e.dimIndex||0;this._wrangled=e.wrangled||[];this._colorMode=e.internalMode;this._colors={others:p["a"].retriveColor(d["a"].dataColors.othersColor),null:p["a"].retriveColor(d["a"].dataColors.nullColor),error:p["a"].retriveColor(d["a"].dataColors.errorColor)};if(t&&"dimension"===e.internalMode&&e.useDimColVal){var a;if(t.oth){a=p["a"].retriveColor(d["a"].resolveColor(t.oth));a.isInvalid()||(this._colors.others=a)}if(t.nul){a=p["a"].retriveColor(d["a"].resolveColor(t.nul));a.isInvalid()||(this._colors.null=a)}}};ue.prototype.getColor=function(e,t){var a=Array.isArray(e)?this._dimIndex>=0?e[this._dimIndex]:void 0:e;var r="measure"!==this._colorMode&&this._wrangled[t]?this._wrangled[t].elemValue:void 0;if(!Array.isArray(e)&&Number.isNaN(+e))return this._colors.error;if(a===se||Array.isArray(e)&&-1!==e.indexOf(se))return this._colors.others;if(a===le||r===le)return this._colors.null;return false};var he=ue;function ce(e){var t={};e&&e.forEach((function(e){t[e.value]=e.baseColor}));return t}function fe(e,t){var a={};t.forEach((function(e){a[e.text]||(a[e.text]=[]);a[e.text].push(e)}));e.forEach((function(e){a[e.value]&&a[e.value].forEach((function(t){t.baseColor=e.baseColor}))}));return t.map((function(e){return e.baseColor}))}function me(e){var t=[];e.forEach((function(e,a){var r=de(e);t[r]=a}));return t}function de(e){return e.elemValue}function pe(e,t,a,r,i){if(r){if(true===i){var n=ve();return n[de(r)%n.length]}if(e&&a){var o=de(r);return a[o%a.length]}}var s=d["a"].resolveColor(t);return"none"===s?d["a"].dataColors.primaryColor:s}function ve(e,t){return d["a"].getPaletteScale(e||"",t)}var _e=i["a"].extend({init:function e(t){this.colors={};this.filler={};this.reverseMapping=[];this.fieldValueMap={};this.app=t},release:function e(){this.colors=null;this.filler=null},setData:function e(t,a,r,i){var o=this;this.wrangled=a.wrangled;var s=a.altMode?a.attrInfo.colorMapRef:r&&r.coloring?r.coloring.colorMapRef:"";function l(e){var t=e||{};o.fieldValueMap=ce(t.colors);o.colors=fe(t.colors||[],a.wrangled||[]);o.filler=t.single;o.palette=ve(t.pal);o.usePalette=t.usePal;o.reverseMapping=me(a.wrangled||[]);o._dimValCols=e;o.autoFill=t.autoFill;return e}if(i)return n["a"].resolve(i.dimValsData).then(l);return M["a"].getColorMap(s,this.app).then(l)},getColor:function e(t){return this.colors[t]?d["a"].resolveColor(this.colors[t]):pe(this.usePalette,this.filler,this.palette,this.wrangled[t],this.autoFill)},getColorFromPreScaledValue:function e(t,a){var r=this.reverseMapping[t];if(this.colors[r])return d["a"].resolveColor(this.colors[r]);if(this.fieldValueMap[a])return d["a"].resolveColor(this.fieldValueMap[a]);return this.usePalette||this.autoFill?pe(this.usePalette,this.filler,this.palette,{elemValue:t},this.autoFill):"none"},getDimValsData:function e(){return this._dimValCols}});var ge=_e;var Me=a("7xom");var qe=a("KBmc");var Ce="primary";var be="dimension";var xe="measure";var De="expression";var ye="multiple";var Ie="master";var Se="dim_master";var Ee="meas_master";var Ne="auto";var Te=qe["a"].baseColor;function Ve(e,t,a,r,i){var n=Array.isArray(a.qDimensionInfo)?a.qDimensionInfo.length:1;var o=a.qMeasureInfo?a.qMeasureInfo.length:0;var s="measure"===r&&we(a.qMeasureInfo);var l="dimension"===r&&we(a.qDimensionInfo);var u=s||l;e&&e!==Ne?"byMultiple"===e?e=u?Ie:ye:"byDimension"===e?e=be:"byMeasure"===e?e=xe:"byExpression"===e?e=De:e===Ce&&(l?e=Se:s&&Te.isSupported(i)&&(e=Ee)):e=n>1&&t!==Ce||t===be?be:we(a.qDimensionInfo)&&(1===n||t===Ce)&&(o<=1||t===Ce)?Se:we(a.qMeasureInfo)&&(n<=1||t===Ce)&&Te.isSupported(i)?Ee:t===Ce||t===Ne&&n<=1&&o<=1?Ce:o>1?ye:be;e===Ie&&(e=s?Ee:Se);return e}function Le(e){var t=false;if(!e)return false;e.coloring&&e.coloring.baseColor&&e.coloring.baseColor.color?t=e.coloring.baseColor:e.baseColor&&e.baseColor.color&&(t=e.baseColor);if(t){"none"===t.color&&(t=d["a"].dataColors.primaryColor);return t}return false}function we(e){return e.filter((function(e){return Le(e)})).length>0}var Pe={determineInternalMode:Ve,getBaseColor:Le};var Ae=a("4nJ1");var Fe=a("oxue");var ke="auto";var Oe="qualitative";var He="primary";var Re="expression";var ze="measure";var Be="auto";var Ue="primary";var je="dimension";var Ge="measure";var We="expression";var Xe="dim_master";var Ye="meas_master";var Je="error";var Ke="first";var Qe="last";var Ze=-3;var $e=-2;var et=qe["a"].baseColor;function tt(e){var t=-Number.MAX_VALUE;var a=Number.MAX_VALUE;var r=true;e.forEach((function(e){if(!Number.isNaN(+e.elemValue)){t=Math.max(e.elemValue,t);a=Math.min(e.elemValue,a);r=false}}));return{min:r?0:a,max:r?10:t}}function at(e){if(!e||!e.length)return 0;e=e.filter((function(e){return"N"===e.qType}));if(1===e.length&&"V"!==e[0].qSubNodes[0].qType)return 1+at(e[0].qSubNodes);return 0}function rt(e,t,a,r){var i=e.auto;var n=e.dimensionID;if(!i&&Me["a"].isByNthDimension(e))return e.byDimDef.activeDimensionIndex;var o=0;var s=Array.isArray(t);var l=s?t.length:1;var u;if(n&&!i)for(o;o<l;++o){u=s?t[o].cId:t.cId;if(u===n)return o}var h=r.qStackedDataPages&&r.qStackedDataPages.length&&r.qStackedDataPages[0].qData&&r.qStackedDataPages[0].qData.length?r.qStackedDataPages[0].qData[0].qSubNodes:null;return a===Ke?at(h):l-1}function it(e,t,a,r,i){if(t===je)return e||a.qDimensionInfo.length>1||i&&a.qSize.qcy>r.qArea.qHeight;if(t===Ge)return"K"===a.qMode||a.qSize.qcy>r.qMatrix.length;return false}function nt(e,t,a){var r=0;if(0===a){while(e&&e.parent)e=e.parent;return e}while(t){if(e.getDimensions().length-1===a)return e;if(e.getDimensions().length-1-r===a)return t;t=t.parent;r++}return}function ot(e,t,a){a=Array.isArray(a)?a:[a];var r=e.qHyperCube.qMeasureInfo;var i=-1!==a.indexOf(Ze)||-1!==a.indexOf($e);return!i&&et.isSupported(e.visualization)&&!!Pe.getBaseColor(r[t])}function st(e,t){t=Array.isArray(t)?t:[t];var a=-1!==t.indexOf(Ze)||-1!==t.indexOf($e);var r=e.qHyperCube.qDimensionInfo.filter((function(e){return!!Pe.getBaseColor(e)})).length>0;return!a&&r}function lt(e){return Pe.getBaseColor(e.filter((function(e){return!!Pe.getBaseColor(e)}))[0])}function ut(){return{dimIndex:0,wrangled:[],valid:false,legendMode:{}}}function ht(e,t){if(!t.enigmaModel||!e.colorMapRef)return n["a"].when(e.qFallbackTitle);return t.enigmaModel.getMeasureList().then((function(t){var a=Fe["a"].findLibraryMeasure(e.colorMapRef,t);return a.qData.labelExpression?a.qData.labelExpression:a.qData.title}))}function ct(e,t){if(!t.enigmaModel||!e.colorMapRef)return n["a"].when(e.qFallbackTitle);return t.enigmaModel.getDimensionList().then((function(t){var a=Fe["a"].findLibraryDimension(e.colorMapRef,t);return a.qData.labelExpression?a.qData.labelExpression:a.qData.title}))}function ft(e){return e.qFallbackTitle&&"="===e.qFallbackTitle.charAt(0)?e.qFallbackTitle.substr(1):e.qFallbackTitle}var mt=i["a"].extend({init:function e(t,a){t=t||{};this._app=a;this._autoMode=t.autoMode||Be;this._multiDimScheme=t.multiDimScheme||Qe;this._qualitativeMap=new re(null,t);this._sequentialMap=new H(null,t,a);this._legendDataProvider=new m;this._legendDataProvider.setColorMap(this);this._specialColorMap=new he;this._dimValsMap=new ge(a);this._enableAltMode=true;this._colorDataInfo=ut();this._title="DEBUG"},getColor:function e(t,a,r,i){var n=this._specialColorMap.getColor(t,i);if(n)return n;if(this._colorDataInfo.internalMode===je&&this._colorDataInfo.useDimColVal)return p["a"].retriveColor(this._dimValsMap.getColor(i));if(this._colorDataInfo.internalMode===Je)return this._qualitativeMap.getColor($e);if(this._colorMode===ze||this._colorMode===Re)return this._sequentialMap.getColor(t,i,r,a);if(this._colorDataInfo.internalMode===Ye&&ot(this._data,r,t))return p["a"].retriveColor(d["a"].resolveColor(Pe.getBaseColor(this._data.qHyperCube.qMeasureInfo[r])));if(this._colorDataInfo.internalMode===Xe&&st(this._data,t))return p["a"].retriveColor(d["a"].resolveColor(lt(this._data.qHyperCube.qDimensionInfo)));return this._qualitativeMap.getColor(t,i,r,a)},getColorScale:function e(){return this._qualitativeMap},getColorFromPreScaledValue:function e(t,a){if(this._colorMode===ze||this._colorMode===Re)return this._sequentialMap.getColorFromPreScaledValue(t);var r=this._specialColorMap.getColor(t);if(r)return r;if(this._colorDataInfo.internalMode===je&&this._colorDataInfo.useDimColVal)return p["a"].retriveColor(this._dimValsMap.getColorFromPreScaledValue(t,a));return this._qualitativeMap.getColorFromPreScaledValue(t)},getTooltipContent:function e(t,a){var i=null;var n;var o;var s;var l;var u;if(this._colorDataInfo.valid){if(this._colorMode===Re){n=this._sequentialMap.getExpressionValue(void 0===a?t.row:a);o=n;if(void 0!==n){this._sequentialMap.getValueFormatter&&(s=this._sequentialMap.getValueFormatter())&&(n=s.formatValue(n));i={label:this.getLegendTitle(),template:oe.createLegendTemplate(n,this._sequentialMap.getColor(t.id,void 0===a?t.row:a,0,n)),num:o}}}if(this._colorDataInfo.altMode){var h=true;if("dimension"===this._colorDataInfo.internalMode){var c=t._attrDims[this._colorDataInfo.attrIndex];if(!c)return;if(t.id===Ze){u=t.id===Ze?r["default"].get("properties.dimensionLimits.others"):c.label?c.label:"";l=this.getColorFromPreScaledValue(Ze)}else if(c.value===$e){u=c.value===$e?"-":c.label?c.label:"";l=this.getColorFromPreScaledValue($e)}else{u=c.label?c.label:"";l=this.getColorFromPreScaledValue(c.value);h=!l.isInvalid()}}else if("measure"===this._colorDataInfo.internalMode){n=void 0!==a?this._colorDataInfo.wrangled[a].elemValue:t.values[this._colorDataInfo.legendMode.rangeSelectionIndex];o=n;h=void 0!==n;u=this._sequentialMap.getValueFormatter&&(s=this._sequentialMap.getValueFormatter())?s.formatValue(n):n;l=this.getColorFromPreScaledValue(n)}h&&(i={label:this.getLegendTitle(),value:"".concat(u),num:o,template:oe.createLegendTemplate(u,l)})}else if("dimension"===this._colorDataInfo.internalMode){var f=t.getDimensions();var m=f[f.length-this._colorDataInfo.dimIndex-1];if(!m)return;u=m;var d=nt(t,t,this._colorDataInfo.dimIndex);l=this.getColorFromPreScaledValue(d.id);l.isInvalid()||(i={label:this.getLegendTitle(),template:oe.createLegendTemplate(u,l)})}}return i},getColorMapping:function e(){return this._legendDataProvider.getColorMapping()},generateScaleBasedMapping:function e(){return this._sequentialMap.generateScaleBasedMapping()},getSelectionIndices:function e(){return this.getDimensionIndex()},getLegendTitle:function e(){if(this._colorMode===ze||this._colorMode===Re)return this._sequentialMap.getLegendTitle();return this._qualitativeMap.getLegendTitle()},getDimensionIndex:function e(){if(this._colorMode===ze)return[0];return[this._qualitativeMap.getDimensionIndex()]},setData:function e(t,a){if(this.released)return n["a"].reject();var r=this;var i=[];this._colorMode=Oe;this._data=t;this._colorDataInfo=ut();var o=ut();var s=n["a"].resolve();var l;var u;var h;var c;var f;if(t.color){l=t.color;var m=t.qHyperCube;var p="";if(!m)return n["a"].resolve().then(D);p=t.qInfo&&t.qInfo.qType?t.qInfo.qType:a;o.internalMode=Pe.determineInternalMode(l.auto?Be:l.mode||Be,this._autoMode,m,l.useBaseColors,p);o.useDimColVal=l.useDimColVal||l.auto&&o.internalMode===je;o.useMeasureGradient=l.useMeasureGradient||l.auto&&o.internalMode===Ge;c=this._data.qHyperCube.qDimensionInfo.length-1;var v=this._data.qHyperCube.qDataPages[0]||this._data.qHyperCube.qStackedDataPages[0]||{qArea:{qHeight:0},qMatrix:[]};f=t.qHyperCube.qDimensionInfo[c];var _=t.qHyperCube.qMeasureInfo[0];var g=c;var M=c;u=-1;var q;if(o.internalMode===je){u=P["a"].getIndexById(f.qAttrDimInfo,P["a"].IDMAP.COLOR_BY_ALTERNATIVE);h=-1!==u?f.qAttrDimInfo[u]:null;q="qAttrDims";if(Me["a"].useFallback(h,l)){u=-1;h=null}}else if(o.internalMode===Ge){u=P["a"].getIndexById(f.qAttrExprInfo,P["a"].IDMAP.COLOR_BY_ALTERNATIVE);h=-1!==u?f.qAttrExprInfo[u]:null;q="qAttrExps"}o.altMode=this._enableAltMode&&!!h&&c>=0&&u>=-1;var C=!o.altMode&&o.internalMode===Ge&&!_;o.valid=(o.altMode&&h&&!h.qError||!o.altMode&&!!f)&&!C;if(!o.valid){o.internalMode=Je;o.allNaN=true;return n["a"].resolve().then(D)}o.dimIndex=c;o.attrIndex=u;o.hasOthers=!!t.qHyperCube.qHasOtherValues;o.othersLabels=t.qHyperCube.qDimensionInfo.map((function(e){return e.othersLabel}));o.activeDimensionIndex=Ae["a"].getValue(t,"color.byDimDef.activeDimensionIndex");o.persistentColors=it(l.persistent,o.internalMode,m,v,o.altMode);o.top=v.qArea.qTop;o.attrInfo=h;if(o.altMode)if(o.internalMode===Ge){o.minMax={min:h.qMin||0,max:h.qMax||10};o.matchingDataMeasure=h.matchMeasure;o.dimSize=false===l.autoMinMax?f.qCardinal:t.qHyperCube.qSize.qcy;t.color.byMeasureDef&&"libraryItem"===t.color.byMeasureDef.type?s=s.then((function(){return ht(h,r._app).then((function(e){o.legendTitle=e}))})):t.color.altLabel?o.legendTitle=t.color.altLabel:o.legendTitle=ft(h)}else if(o.internalMode===je){o.dimSize=o.persistentColors?h.qCardinal:h.qSize.qcy;t.color.byDimDef&&"libraryItem"===t.color.byDimDef.type?s=s.then((function(){return ct(h,r._app).then((function(e){o.legendTitle=e}))})):t.color.altLabel?o.legendTitle=t.color.altLabel:o.legendTitle=ft(h)}else o.legendTitle=h.label||h.qFallbackTitle;else if(o.internalMode===Ge){g=c+1;o.minMax=Number.isNaN(+_.qMin)||Number.isNaN(+_.qMax)?null:{min:_.qMin||0,max:_.qMax||10};o.legendTitle=_.qFallbackTitle;o.dimSize=false===l.autoMinMax?f.qCardinal:t.qHyperCube.qSize.qcy}else if(o.internalMode===je){c=rt(l,m.qDimensionInfo,this._multiDimScheme,m);g=c;o.dimIndex=c;f=t.qHyperCube.qDimensionInfo[c];o.legendTitle=f.qFallbackTitle;o.dimSize=o.persistentColors?f.qCardinal:t.qHyperCube.qSize.qcy}else o.internalMode===We&&(o.dimSize=false===l.autoMinMax?f.qCardinal:t.qHyperCube.qSize.qcy);if(o.internalMode===Ge||o.internalMode===je){o.wrangled=w.wrangleData(t.qHyperCube,u,g,!(!o.altMode||!o.valid)&&q,o.internalMode===je,M);o.allNaN=o.altMode&&0===o.wrangled.filter((function(e){return o.internalMode===je?e.elemValue!==$e&&!Number.isNaN(+e.elemValue):!Number.isNaN(+e.elemValue)})).length}o.internalMode!==Ge||o.persistentColors||(o.minMax=tt(o.wrangled));if(t.color.auto)this._colorMode=ke;else switch(o.internalMode){case Ge:this._colorMode=ze;break;case We:this._colorMode=Re;break;case Ue:this._colorMode=He;break;default:break}o.dimensionScheme=t.color.dimensionScheme;o.internalMode!==Ye&&o.internalMode!==Xe||(o.dimensionScheme=d["a"].dataPalettes[0].propertyValue);var b;s.then((function(){if(r._colorMode===ze||r._colorMode===Re)i.push(n["a"].resolve(r._sequentialMap.setData(t,o,r._snapshotChartData)).then((function(){b=r._sequentialMap.getLegendMode();x(b)})));else{r._qualitativeMap.setData(t,o);b=r._qualitativeMap.getLegendMode();x(b)}}))}function x(e){var a;a=o.internalMode===Ye&&1===r._data.qHyperCube.qMeasureInfo.length||o.internalMode===Xe&&1===r._data.qHyperCube.qDimensionInfo.length?Ue:e[2];o.legendMode={discrete:"scale"!==e[0],boxType:e[1],colorMode:a,selectionEnabled:!e[3],altMode:o.altMode,rangeSelectionIndex:o.altMode?r._data.qHyperCube.qMeasureInfo.length:0};if(o.altMode&&o.internalMode===je&&o.valid&&"dimension"===o.legendMode.colorMode){o.legendPath="/qHyperCubeDef/qDimensions/".concat(c,"/qAttributeDimensions/").concat(u);o.legendPages=[{qTop:0,qLeft:0,qWidth:2,qHeight:3e3}];o.altLocked=h.qLocked}r._legendDataProvider.setData(t)}function D(){r._colorDataInfo=o;return r._colorDataInfo}return s.then((function(){if(o.internalMode===je&&o.useDimColVal)return r._dimValsMap.setData(l,o,f,r._snapshotChartData).then((function(e){r._specialColorMap.setProperties(o,e);e?o.persistentColors=true:o.useDimColVal=false;return D()}));r._specialColorMap.setProperties(o);return n["a"].all(i).then(D)}))},hasAttributeDimension:function e(){return this._colorDataInfo.altMode&&!!this._colorDataInfo.legendPath},getAttributeDimensionInfo:function e(){return this.hasAttributeDimension()?[this._colorDataInfo.attrInfo]:[]},getColorDataInfo:function e(){return this._colorDataInfo},setAltModeEnabled:function e(t){this._enableAltMode=t},setMeasureFormatters:function e(t){this._measureFormatters=t;this._sequentialMap&&this._sequentialMap.setMeasureFormatters(t)},setGenericFormatter:function e(t){this._sequentialMap&&this._sequentialMap.setGenericFormatter(t)},getValueFormatter:function e(){return this._sequentialMap.getValueFormatter()},setDimensionTree:function e(t){this._dimensionTree=t;this._legendDataProvider&&this._legendDataProvider.setDimensionTree(t)},getLegendDataProvider:function e(){return this._legendDataProvider},setSnapshotChartData:function e(t){this._snapshotChartData=t},getSnapshotChartData:function e(){var t=[];var a=this._dimValsMap.getDimValsData();a&&t.push({key:"dimValsData",data:a});var r=this._sequentialMap&&this._sequentialMap._measureGradient?this._sequentialMap._measureGradient:null;r&&t.push({key:"measureGradient",data:r});return t},release:function e(){this._qualitativeMap.release&&this._qualitativeMap.release();this._sequentialMap.release&&this._sequentialMap.release();this._legendDataProvider.release&&this._legendDataProvider.release();this._dimensionTree=null;this._legendDataProvider=null;this._sequentialMap=null;this._qualitativeMap=null;this.released=true}});Object.defineProperties(mt.prototype,{mode:{get:function e(){return this._colorMode}}});Object.defineProperties(mt,{AUTO:{value:ke,writable:false},PRIMARY:{value:He,writable:false},MEASURE:{value:ze,writable:false},EXPRESSION:{value:Re,writable:false},QUALITATIVE:{value:Oe,writable:false},DIMENSION:{value:je,writable:false}});Object.defineProperties(mt.prototype,{AUTO:{value:ke,writable:false},PRIMARY:{value:He,writable:false},MEASURE:{value:ze,writable:false},EXPRESSION:{value:Re,writable:false},QUALITATIVE:{value:Oe,writable:false},DIMENSION:{value:je,writable:false}});var dt=t["a"]=mt}}]);